<section class="space-y-4">
  <!-- Cabe√ßalho -->
  <div class="flex items-center justify-between gap-3 flex-wrap">
    <h1 class="text-xl font-semibold tracking-tight">Ve√≠culos</h1>
    <div class="flex items-center gap-2">
      
      <!-- Bot√µes de a√ß√£o -->
      <button
      *ngIf="tab() === 'brands'"
      class="h-9 px-3 rounded-md text-white bg-[#0f3d2e] hover:bg-[#0c3427]"
      (click)="openBrandModal()"
      >
      Nova Marca
    </button>
    <button
    *ngIf="tab() === 'models'"
    class="h-9 px-3 rounded-md text-white bg-[#0f3d2e] hover:bg-[#0c3427]"
    (click)="openModelModal()"
    >
    Novo Modelo
  </button>
    <!-- Tabs -->
    <div class="inline-flex rounded-md border border-black/10 overflow-hidden">
      <button
        class="h-9 px-3 text-sm"
        [class.bg-white]="tab() === 'brands'"
        [class.bg-neutral-100]="tab() !== 'brands'"
        (click)="onTabChange('brands')"
      >
        Marcas
      </button>
      <button
        class="h-9 px-3 text-sm border-l border-black/10"
        [class.bg-white]="tab() === 'models'"
        [class.bg-neutral-100]="tab() !== 'models'"
        (click)="onTabChange('models')"
      >
        Modelos
      </button>
    </div>
    </div>
  </div>

  <!-- TAB: MARCAS -->
  <div *ngIf="tab() === 'brands'">
    <!-- Filtros -->
    <div class="flex items-center gap-2 mb-4">
      <input
        class="h-9 px-3 rounded-md border border-black/10 outline-none focus:ring focus:ring-[#0f3d2e]/15 flex-1 max-w-xs"
        placeholder="Buscar marca..."
        [value]="brandsSearch()"
        (input)="brandsSearch.set($any($event.target).value); loadBrands()"
      />
      <button
        class="h-9 px-3 rounded-md border border-black/10 hover:bg-gray-50"
        (click)="loadBrands()"
      >
        Atualizar
      </button>
    </div>

    <!-- Loading -->
    <div *ngIf="brandsLoading()" class="grid gap-2">
      <div class="h-12 rounded-md bg-neutral-100 animate-pulse"></div>
      <div class="h-12 rounded-md bg-neutral-100 animate-pulse"></div>
      <div class="h-12 rounded-md bg-neutral-100 animate-pulse"></div>
    </div>

    <!-- Lista de Marcas -->
    <div *ngIf="!brandsLoading()">
      <div
        *ngIf="brands().length === 0"
        class="border border-dashed border-black/10 rounded-xl p-8 text-center text-neutral-500"
      >
        Nenhuma marca encontrada.
      </div>

      <div
        *ngIf="brands().length > 0"
        class="overflow-x-auto rounded-lg border border-black/10 bg-white"
      >
        <table class="w-full text-sm">
          <thead class="bg-neutral-50">
            <tr class="text-left text-neutral-600">
              <th class="py-2 px-3">Nome</th>
              <th class="py-2 px-3 text-right">A√ß√µes</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-black/10">
            <tr *ngFor="let brand of brands()" class="hover:bg-neutral-50">
              <td class="py-2 px-3 font-medium">{{ brand.name }}</td>
              <td class="py-2 px-3 text-right">
                <div class="flex items-center gap-2 justify-end">
                  <button
                    class="h-8 px-3 rounded-md border border-black/10 hover:bg-gray-50"
                    (click)="openBrandModal(brand)"
                  >
                    Editar
                  </button>
                  <button
                    class="h-8 px-3 rounded-md border border-red-200 text-red-700 hover:bg-red-50"
                    (click)="deleteBrand(brand)"
                  >
                    Excluir
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- TAB: MODELOS -->
  <div *ngIf="tab() === 'models'">
    <!-- Filtros -->
    <div class="flex items-center gap-2 mb-4 flex-wrap">
      <input
        class="h-9 px-3 rounded-md border border-black/10 outline-none focus:ring focus:ring-[#0f3d2e]/15 flex-1 max-w-xs"
        placeholder="Buscar modelo..."
        [value]="modelsSearch()"
        (input)="modelsSearch.set($any($event.target).value); loadModels()"
      />
      <select
        class="h-9 px-3 rounded-md border border-black/10 outline-none focus:ring focus:ring-[#0f3d2e]/15"
        [value]="selectedBrandId()"
        (change)="selectedBrandId.set($any($event.target).value); loadModels()"
      >
        <option value="">Todas as marcas</option>
        <option *ngFor="let brand of availableBrands()" [value]="brand.id">
          {{ brand.name }}
        </option>
      </select>
      <button
        class="h-9 px-3 rounded-md border border-black/10 hover:bg-gray-50"
        (click)="loadModels()"
      >
        Atualizar
      </button>
    </div>

    <!-- Loading -->
    <div *ngIf="modelsLoading()" class="grid gap-2">
      <div class="h-12 rounded-md bg-neutral-100 animate-pulse"></div>
      <div class="h-12 rounded-md bg-neutral-100 animate-pulse"></div>
      <div class="h-12 rounded-md bg-neutral-100 animate-pulse"></div>
    </div>

    <!-- Lista de Modelos -->
    <div *ngIf="!modelsLoading()">
      <div
        *ngIf="models().length === 0"
        class="border border-dashed border-black/10 rounded-xl p-8 text-center text-neutral-500"
      >
        Nenhum modelo encontrado.
      </div>

      <div
        *ngIf="models().length > 0"
        class="overflow-x-auto rounded-lg border border-black/10 bg-white"
      >
        <table class="w-full text-sm">
          <thead class="bg-neutral-50">
            <tr class="text-left text-neutral-600">
              <th class="py-2 px-3">Marca</th>
              <th class="py-2 px-3">Modelo</th>
              <th class="py-2 px-3">Categoria</th>
              <th class="py-2 px-3 text-right">A√ß√µes</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-black/10">
            <tr *ngFor="let model of models()" class="hover:bg-neutral-50">
              <td class="py-2 px-3">{{ model.brand?.name || '-' }}</td>
              <td class="py-2 px-3 font-medium">{{ model.name }}</td>
              <td class="py-2 px-3">
                <span
                  *ngIf="model.specs?.category"
                  class="inline-flex items-center gap-1 rounded-md px-2 py-0.5 text-xs bg-neutral-100 text-neutral-700"
                >
                  {{ model.specs.category }}
                </span>
                <span *ngIf="!model.specs?.category" class="text-neutral-400">-</span>
              </td>
              <td class="py-2 px-3 text-right">
                <div class="flex items-center gap-2 justify-end">
                  <button
                    class="h-8 px-3 rounded-md border border-black/10 hover:bg-gray-50"
                    (click)="openModelModal(model)"
                  >
                    Editar
                  </button>
                  <button
                    class="h-8 px-3 rounded-md border border-red-200 text-red-700 hover:bg-red-50"
                    (click)="deleteModel(model)"
                  >
                    Excluir
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Modal de Marca -->
  <div *ngIf="showBrandModal()" class="fixed inset-0 z-50 bg-black/40" (click)="closeBrandModal()"></div>
  <div *ngIf="showBrandModal()" class="fixed inset-0 z-50 grid place-items-center p-4">
    <div class="w-full max-w-md bg-white rounded-xl border border-black/10 shadow-sm" (click)="$event.stopPropagation()">
      <div class="px-5 py-3 border-b bg-white flex items-center justify-between">
        <h3 class="text-lg font-semibold">
          {{ editingBrand() ? 'Editar Marca' : 'Nova Marca' }}
        </h3>
        <button
          class="h-9 px-3 rounded-md border border-black/10 hover:bg-gray-50"
          (click)="closeBrandModal()"
        >
          Fechar
        </button>
      </div>
      <div class="p-5">
        <form (ngSubmit)="saveBrand()" class="space-y-4">
          <div>
            <label class="block text-sm font-medium mb-1">Nome *</label>
            <input
              type="text"
              class="w-full h-9 px-3 rounded-md border border-black/10 outline-none focus:ring focus:ring-[#0f3d2e]/15"
              [(ngModel)]="brandForm().name"
              name="brandName"
              required
            />
          </div>

          <div *ngIf="brandFormError()" class="text-red-600 text-sm">
            {{ brandFormError() }}
          </div>

          <div class="flex items-center gap-3 pt-4">
            <button
              type="submit"
              class="h-9 px-4 rounded-md text-white bg-[#0f3d2e] hover:bg-[#0c3427] disabled:opacity-50"
              [disabled]="brandFormLoading()"
            >
              {{ brandFormLoading() ? 'Salvando...' : 'Salvar' }}
            </button>
            <button
              type="button"
              class="h-9 px-4 rounded-md border border-black/10 hover:bg-gray-50"
              (click)="closeBrandModal()"
            >
              Cancelar
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Modal de Modelo -->
  <div *ngIf="showModelModal()" class="fixed inset-0 z-50 bg-black/40" (click)="closeModelModal()"></div>
  <div *ngIf="showModelModal()" class="fixed inset-0 z-50 grid place-items-center p-4">
    <div class="w-full max-w-6xl bg-white rounded-xl border border-black/10 shadow-sm max-h-[95vh] overflow-hidden flex flex-col" (click)="$event.stopPropagation()">
      <div class="px-5 py-3 border-b bg-white flex items-center justify-between">
        <h3 class="text-lg font-semibold">
          {{ editingModel() ? 'Editar Modelo' : 'Novo Modelo' }}
        </h3>
        <button
          class="h-9 px-3 rounded-md border border-black/10 hover:bg-gray-50"
          (click)="closeModelModal()"
        >
          Fechar
        </button>
      </div>
      <div class="flex-1 overflow-y-auto p-5">
        <app-vehicle-model-form
          [model]="editingModel() || undefined"
          [brands]="availableBrands()"
          (save)="onModelFormSave($event)"
          (cancel)="onModelFormCancel()"
        ></app-vehicle-model-form>
        <div *ngIf="modelFormError()" class="text-red-600 text-sm mt-4">
          {{ modelFormError() }}
        </div>
      </div>
    </div>
  </div>

  <!-- Modal de Upload CSV -->
  <div *ngIf="showCSVModal()" class="fixed inset-0 z-50 bg-black/40" (click)="closeCSVModal()"></div>
  <div *ngIf="showCSVModal()" class="fixed inset-0 z-50 grid place-items-center p-4">
    <div class="w-full max-w-2xl bg-white rounded-xl border border-black/10 shadow-sm" (click)="$event.stopPropagation()">
      <div class="px-5 py-3 border-b bg-white flex items-center justify-between">
        <h3 class="text-lg font-semibold">Importar Ve√≠culos via CSV</h3>
        <button
          class="h-9 px-3 rounded-md border border-black/10 hover:bg-gray-50"
          (click)="closeCSVModal()"
        >
          Fechar
        </button>
      </div>
      <div class="p-5 space-y-4">
        <div>
          <p class="text-sm text-neutral-600 mb-4">
            Selecione um arquivo CSV com os dados dos ve√≠culos. Use o bot√£o abaixo para baixar o template.
          </p>
          <button
            type="button"
            class="h-9 px-4 rounded-md border border-black/10 hover:bg-gray-50 mb-4"
            (click)="downloadCSVTemplate()"
          >
            üì• Baixar Template CSV
          </button>
        </div>

        <div>
          <label class="block text-sm font-medium mb-1">Arquivo CSV</label>
          <input
            type="file"
            accept=".csv"
            class="w-full h-9 px-3 rounded-md border border-black/10 outline-none focus:ring focus:ring-[#0f3d2e]/15"
            (change)="onCSVFileSelected($event)"
          />
          <p *ngIf="csvFile()" class="text-sm text-neutral-600 mt-2">
            Arquivo selecionado: {{ csvFile()?.name }}
          </p>
        </div>

        <div class="flex items-center gap-3 pt-4">
          <button
            type="button"
            class="h-9 px-4 rounded-md text-white bg-[#0f3d2e] hover:bg-[#0c3427] disabled:opacity-50"
            [disabled]="!csvFile() || csvLoading()"
            (click)="uploadCSV()"
          >
            {{ csvLoading() ? 'Importando...' : 'Importar' }}
          </button>
          <button
            type="button"
            class="h-9 px-4 rounded-md border border-black/10 hover:bg-gray-50"
            (click)="closeCSVModal()"
          >
            Cancelar
          </button>
        </div>
      </div>
    </div>
  </div>
</section>

